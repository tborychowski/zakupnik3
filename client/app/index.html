<Categories ref:categories></Categories>
<div class="form-box">
	<YearMonthPicker ref:picker></YearMonthPicker>
	<Form ref:form></Form>
</div>
<Table ref:table></Table>

<script>
import YearMonthPicker from '../year-month-picker';
import Form from '../form';
import Table from '../table';
import Categories from '../categories';
import Data from '../data';

export default {
	data () { return {}; },
	components: { Form, Table, YearMonthPicker, Categories },
	oncreate () {
		const date = new Date().toISOString().substr(0, 7);
		Data.Groups.get().then(groups => this.refs.form.set({ date, groups }));

		this.refs.form.on('change', this.onFormChange.bind(this));
		this.refs.form.on('remove', this.onFormSubmit.bind(this));
		this.refs.form.on('submit', this.onFormSubmit.bind(this));
		this.refs.picker.on('change', this.onDateChange.bind(this));
		this.refs.table.on('click', this.onTableClick.bind(this));
	},

	methods: {
		onDateChange (date) {
			this.refs.form.set({ date: date.dateStr });
			this.refs.table.set({ date: date.dateStr });
		},

		onFormChange (data) {
			if (data && data.length) this.refs.table.preview(data);
			else this.refs.table.endPreview();
		},

		onFormSubmit () { this.refs.table.load(); },

		onTableClick (item) { this.refs.form.edit(item); },
	}
};

</script>
