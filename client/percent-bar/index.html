<div class="percent-bar">
	<div class="percent-bar-wrapper">
		<div class="percent-bar-row income-row">
			{#each income as cat}
			<div class="percent-bar-chunk" title="{cat.name}: {cat.percent}%" style="width: {cat.incomePercent}%">{cat.name}</div>
			{/each}
		</div>
		<div class="percent-bar-row expense-row">
			{#each expense as cat}
			<div class="percent-bar-chunk" title="{cat.name}: {cat.percent}%" style="width: {cat.percent}%">{cat.name}</div>
			{/each}
		</div>
	</div>
</div>

<script>
import {EVENT, Store} from '../data';

export default {
	store: () => Store,
	computed: {
		income ({ $categoryTree }) {
			const subcats = [];
			$categoryTree.filter(c => c.income).forEach(cat => {
				subcats.push(...cat.items.filter(s => s.income && s.incomePercent));
			});
			return subcats.sort((a, b) => b.incomePercent - a.incomePercent);
		},
		expense ({ $categoryTree }) {
			const cats = $categoryTree
				.filter(c => !c.income && c.percent)
				.sort((a, b) => b.percent - a.percent);

			const main = cats.slice(0, 5);
			const rest = cats.slice(5).reduce((p, c) => p += c.percent, 0);
			if (rest) main.push({ name: '...', percent: rest });
			return main;
		}
	},
	methods: {
	}
};
</script>
